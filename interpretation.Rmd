---
params:
  prm: NULL
  kind: 0
pagetitle: Polar Bear Demography
author: Nikita Platonov
bibliography: ./demography.bib
link-citations: true
csl: https://nplatonov.github.io/platt3.csl
csl2: C:/platt/R/style/platt3.csl
output:
   bookdown::html_document2:
      base_format: rmarkdown::html_vignette
      css: https://nplatonov.github.io/html_vignette.css
      css2: C:/platt/R/style/html_vignette.css
      lib_dir: ./resources
      self_containded: false
      number_sections: no
   bookdown::pdf_document2:
      toc: false
      number_sections: false
   pdf_document:
      fig_caption: false
   html_fragment: #
---

```{r setup,include=FALSE}
# require(ggplot2)
res <- params$prm
kind <- params$kind
if (kind==0) {
   if (file.exists("analysis.rds")) {
      res <- readRDS("analysis.rds")
      input <- res$input
   }
   else {
      source("./main.R")
      input <- randomize()
      res <- analyze(do.call("simulate",input))
   }
   kind <- 2
}
input <- res$input
knitr::opts_chunk$set(fig.align="center",fig.width=6,fig.height=4.8
                     ,widgetframe_widgets_dir='./resources'
                     )
```

```{r eval=TRUE,include=FALSE}
filetype <- knitr::opts_knit$get("rmarkdown.pandoc.to")
```
---- 

*Mockup for dynamical report. Will contain more details of 'Results' tab.*

## Polar Bear Demography

This is a simulator of polar bear lifespan based on certain demographical parameters.

In scenario, maximal age is **`r input$max.age`** years.


```{r p3, echo=FALSE, fig.cap="Distribuion of number of cubs during lifespan"}
if (!is.null(res$p3)) {
   if (filetype %in% c("html4","latex","html")) {
      print(res$p3)
     # print(class(res$p3))
   }
   else if (filetype %in% c("zhtml4","zhtml")) {
      print("HTML PLOTLY")
      require(widgetframe)
      suppressMessages({
         require(plotly)
      })
      frameWidget(ggplotly(res$p3))#,height=590,width=790)
      ##~ if (TRUE) {
         ##~ require(widgetframe)
         ##~ require(plotly)
         ##~ frameWidget(ggplotly(res$p3))#,height=590,width=790)
      ##~ }
      ##~ else if (TRUE)
         ##~ plotly::ggplotly(res$p3,dynamicTicks=!TRUE)
      ##~ else if (TRUE) {
         ##~ print(res$p3)
         ##~ plotly::ggplotly()
      ##~ }
   }
}
```

`r if ((kind==2)&&(!is.null(res$p3))) "Histogram of cubs during lefespan per female is presented on Fig.\\@ref(fig:p3)."`

Life expectancy in the wild can be as long as 30 years. In captivity, life expectancy can reach 40 years.

Females reach maturity at 4 to 6 years. Polar bears mate from late March to late May, and cubs are born between late November and early January. Litter size ranges from 1 to 3 cubs; two is most common. Cubs remain with their mothers until they are two-and-a-half years of age. (In western Hudson Bay , some females used to wean cubs at 1.5 years).


Polar bears in the wild can live to be 30 years of age, but this is rare. Most adults die before they reach 25 years.

+ Every year some bears are destroyed as "problem bears" around Churchill [@Lunn_1985].

+ @Clarkson_1991 pointed on the case when a female and her cubs died when their den collapsed.

---
